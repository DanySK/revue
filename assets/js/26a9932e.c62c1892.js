"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[6330],{1044:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=n(4848),t=n(8453);const i={},o="Kubernetes",l={id:"report/deployment/kubernetes",title:"Kubernetes",description:"Revue can be deployed using Kubernetes.",source:"@site/docs/report/deployment/kubernetes.md",sourceDirName:"report/deployment",slug:"/report/deployment/kubernetes",permalink:"/revue/docs/report/deployment/kubernetes",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Docker Compose",permalink:"/revue/docs/report/deployment/docker-compose"},next:{title:"Conclusions",permalink:"/revue/docs/report/conclusions"}},a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"How to deploy the system",id:"how-to-deploy-the-system",level:2},{value:"Notes",id:"notes",level:3},{value:"Horizontal Pod Autoscaling",id:"horizontal-pod-autoscaling",level:2},{value:"Benchmark",id:"benchmark",level:3},{value:"Monitoring",id:"monitoring",level:2}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"kubernetes",children:"Kubernetes"})}),"\n",(0,r.jsxs)(s.p,{children:["Revue can be deployed using ",(0,r.jsx)(s.strong,{children:"Kubernetes"}),".\nThe system is mapped to Kubernetes components like ",(0,r.jsx)(s.strong,{children:"Deployments"}),",\n",(0,r.jsx)(s.strong,{children:"Services"}),", ",(0,r.jsx)(s.strong,{children:"Ingress"}),", ",(0,r.jsx)(s.strong,{children:"Persistent Volume Claims"}),", and ",(0,r.jsx)(s.strong,{children:"ConfigMaps"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"In particular, for core microservices of the system, the following k8s configuration files are provided:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Deployment"}),": it is responsible for creation and the lifecycle of pods."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Service"}),":","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"ClusterIP: when there's no need to expose the service outside the cluster."}),"\n",(0,r.jsx)(s.li,{children:"LoadBalancer: to expose the service outside the cluster."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Ingress"}),": An API object that manages external access to the services in a cluster, typically HTTP. An ingress lets\nyou map traffic to different backends based on rules you define via the Kubernetes API."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Horizontal Pod Autoscaler"}),": to automatically adjust the number of pods based on the current service's workload."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"For those services that need to store data, also the following configuration files are provided:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Persistent Volume Claim"}),": to store data that needs to persist even after the pod is deleted."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"ConfigMap"}),": to store configuration data and database initialization scripts."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["We chose to use ",(0,r.jsx)(s.a,{href:"https://traefik.io/",children:"Traefik"})," as the Ingress Controller and reverse proxy.\nTraefik is a modern HTTP reverse proxy and load balancer that can be used to expose services outside the cluster.\nEach request to a microservice will pass through Traefik, which will route the request to the correct service."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Kubernetes",src:n(9815).A+"",width:"1036",height:"682"})}),"\n",(0,r.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"A Kubernetes cluster running"}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"kubectl"})," installed"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"Metallb"})," or a cloud provider Load Balancer"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"Helm Charts"})," installed"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["With Revue, it is also provided a guide to creating a K3s cluster on Raspberry PIs 5\nthat can be found ",(0,r.jsx)(s.a,{href:"https://github.com/revue-org/revue-kubernetes",children:"here"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"how-to-deploy-the-system",children:"How to deploy the system"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Log in to your cluster's master node."}),"\n",(0,r.jsxs)(s.li,{children:["Clone the ",(0,r.jsx)(s.a,{href:"https://github.com/revue-org/revue-kubernetes/",children:"revue-kubernetes"})," repository."]}),"\n",(0,r.jsx)(s.li,{children:"Move to the cloned repository"}),"\n",(0,r.jsx)(s.li,{children:"Run:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:" ./deploy.sh\n"})}),"\n",(0,r.jsx)(s.h3,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["This guide assumes that cluster is running on a on-premise environment. In particular ",(0,r.jsx)(s.code,{children:"MetalLB"})," is used to expose\nservices outside the cluster."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"horizontal-pod-autoscaling",children:"Horizontal Pod Autoscaling"}),"\n",(0,r.jsxs)(s.p,{children:["A ",(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/",children:"HorizontalPodAutoscaler"})," (HPA)\nin Kubernetes scales the workload horizontally by increasing or decreasing the number of Pods in response to load\nchanges."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"HPA",src:n(6549).A+"",width:"578",height:"578"})}),"\n",(0,r.jsx)(s.p,{children:"The scaling is based on specific configurations file in which resources limits are defined.\nThis helped us to meet QA requirements and to optimize the resources used by the system, limiting the costs."}),"\n",(0,r.jsx)(s.p,{children:"Example of a configuration file targeting CPU usage:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"  metrics:\n    - type: Resource\n      resource:\n        name: cpu                            # Scale based on CPU usage\n        target:\n          type: Utilization\n          averageUtilization: 60             # Target 60% CPU utilization\n"})}),"\n",(0,r.jsx)(s.h3,{id:"benchmark",children:"Benchmark"}),"\n",(0,r.jsxs)(s.p,{children:["The system has been tested with a load of 1000 requests per second,\nand the autoscaling feature has been able to manage the workload efficiently.\nEvery service can scale up to 5 replicas.\nYou can find the bash scripts to stress the system with different workloads in\nthe ",(0,r.jsx)(s.a,{href:"https://github.com/revue-org/revue-kubernetes",children:"revue-kubernetes"})," repository."]}),"\n",(0,r.jsx)(s.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,r.jsx)(s.p,{children:"The system is monitored using two powerful tools:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"https://prometheus.io/",children:"Prometheus"})})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"https://grafana.com/",children:"Grafana"})})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Prometheus and Grafana are widely used tools for monitoring and visualization in cloud-native environments."}),"\n",(0,r.jsxs)(s.p,{children:["Prometheus is a powerful time-series database specifically designed for reliability and performance in capturing\nreal-time metrics.\nIt excels at ",(0,r.jsx)(s.strong,{children:"scraping"})," metrics from a variety of endpoints, such as servers, applications, and infrastructure\ncomponents, using a ",(0,r.jsx)(s.em,{children:"pull-based model"}),".\nPrometheus also supports alerting based on flexible queries, enabling users to identify and\nact on issues quickly."]}),"\n",(0,r.jsxs)(s.p,{children:["Grafana complements Prometheus by providing a user-friendly platform for ",(0,r.jsx)(s.strong,{children:"data visualization"}),".\nIt allows users to create customizable dashboards to monitor system performance, track trends, and troubleshoot problems\nvisually."]}),"\n",(0,r.jsxs)(s.p,{children:["In the ",(0,r.jsx)(s.a,{href:"https://github.com/revue-org/revue/blob/main/README.md",children:"README"})," of the main repository, is explained how to\naccess Prometheus and Grafana dashboards."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Grafana Dashboard",src:n(5713).A+"",width:"3270",height:"1810"})})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},6549:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/hpa-kubernetes-da5e4262e02ae7d5ca0bf448ba1be52c.png"},9815:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/kubernetes-deployment-34b35a25697eab13af91c49c37c24b23.png"},5713:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/grafana-monitoring-c271cd77ae595b778df237b3f09f4142.png"},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var r=n(6540);const t={},i=r.createContext(t);function o(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);